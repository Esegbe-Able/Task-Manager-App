@page "/"
@inject TaskService taskService 

<h1 style="text-align:center; font-weight:bolder;">Task Manager</h1>

<div class="Task-section">
    <label style="font-size:2.5rem; font-family:'Poppins'; font-weight:600; color:#27104E;">Add Your Task</label>
    <div>
    <input class="Input-task-title" @bind="newTaskTitle" placeholder=" Title" />
    </div>
    <div>
        <textarea class="Input-task-desc" @bind="newTaskDescription" placeholder="  Describe your task" cols="50" rows="5"/>
    </div>
    <div>
        @foreach (var category in defaultCategories)
        {
            <button @onclick="() => SetCategory(category)">@category</button>
        }
    </div>
    <button class="btn-add" @onclick="AddTask">Add Task</button>

</div>
<div>
   <h3>My Tasks</h3>
</div>



<div class="task-grid-cat">
    @foreach (var category in defaultCategories)
    {
        <div class="cat"><h3>@category</h3> </div>
        <div class="task-grid">
            @foreach (var task in tasks.Where(t => t.Category == category))
            {
                <div class="task-box">
                    <h4>@task.Title</h4>
                    <!-- Additional task details -->
                    <div>ID: @task.Id</div>
                    <div><input @bind="task.Description" /></div>
                    <div><input type="checkbox" @bind="task.IsCompleted" /> Completed</div>
                    <div>
                        <button @onclick="() => UpdateTask(task)">Update</button>
                        <button @onclick="() => DeleteTask(task.Id)">Delete</button>
                    </div>
                </div>
            }
        </div>
    }

</div>

@code {
    private string newTaskTitle = "";
    private string newTaskDescription = "";
    private List<TaskModel> tasks;

    private string newTaskCategory = "";
    private List<string> defaultCategories = new List<string> { "Study", "Personal", "Work", "Church" }; // Add your default categories here

    private void SetCategory(string category) //Method to set category 
    {
        newTaskCategory = category;
    }

    protected override void OnInitialized()
    {
        tasks = taskService.GetTasks();
    }

    private void AddTask()
    {
        if (!string.IsNullOrEmpty(newTaskTitle) && !string.IsNullOrEmpty(newTaskCategory))
        {
            taskService.AddTask(new TaskModel
                { 
                    Title = newTaskTitle, 
                    Description = newTaskDescription,
                    Category = newTaskCategory
                });

            newTaskTitle = "";
            newTaskDescription = "";
            newTaskCategory = "";
            tasks = taskService.GetTasks();
        }
    }

    private void UpdateTask(TaskModel task)
    {
        taskService.UpdateTask(task);
    }

    private void DeleteTask(int taskId)
    {
        taskService.DeleteTask(taskId);
        tasks = taskService.GetTasks();
    }



}
